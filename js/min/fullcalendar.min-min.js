jQuery(document).ready(function($){function e(e){this.element=e,this.timeline=this.element.find(".timeline"),this.timelineItems=this.timeline.find("li"),this.timelineItemsNumber=this.timelineItems.length,this.timelineStart=n(this.timelineItems.eq(0).text()),this.timelineUnitDuration=n(this.timelineItems.eq(1).text())-n(this.timelineItems.eq(0).text()),this.eventsWrapper=this.element.find(".events"),this.eventsGroup=this.eventsWrapper.find(".events-group"),this.singleEvents=this.eventsGroup.find(".single-event"),this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.modal=this.element.find(".event-modal"),this.modalHeader=this.modal.find(".header"),this.modalHeaderBg=this.modal.find(".header-bg"),this.modalBody=this.modal.find(".body"),this.modalBodyBg=this.modal.find(".body-bg"),this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.initSchedule()}function t(){d.forEach(function(e){e.scheduleReset()}),l=!1}function n(e){e=e.replace(/ /g,"");var t=e.split(":"),n=60*parseInt(t[0])+parseInt(t[1]);return n}function i(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}var a="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",o=$(".csstransitions").length>0;o||(a="noTransition"),e.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents()},e.prototype.scheduleReset=function(){var e=this.mq();"desktop"!=e||this.element.hasClass("js-full")?"mobile"==e&&this.element.hasClass("js-full")?(this.element.removeClass("js-full loading"),this.eventsGroup.children("ul").add(this.singleEvents).removeAttr("style"),this.eventsWrapper.children(".grid-line").remove(),this.element.hasClass("modal-is-open")&&this.checkEventModal()):"desktop"==e&&this.element.hasClass("modal-is-open")?(this.checkEventModal("desktop"),this.element.removeClass("loading")):this.element.removeClass("loading"):(this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.element.addClass("js-full"),this.placeEvents(),this.element.hasClass("modal-is-open")&&this.checkEventModal())},e.prototype.initEvents=function(){var e=this;this.singleEvents.each(function(){var t='<span class="event-date">'+$(this).data("start")+" - "+$(this).data("end")+"</span>";$(this).children("a").prepend($(t)),$(this).on("click","a",function(t){t.preventDefault(),e.animating||e.openModal($(this))})}),this.modal.on("click",".close",function(t){t.preventDefault(),e.animating||e.closeModal(e.eventsGroup.find(".selected-event"))}),this.element.on("click",".cover-layer",function(t){!e.animating&&e.element.hasClass("modal-is-open")&&e.closeModal(e.eventsGroup.find(".selected-event"))})},e.prototype.placeEvents=function(){var e=this;this.singleEvents.each(function(){var t=n($(this).attr("data-start")),i=n($(this).attr("data-end"))-t,a=e.eventSlotHeight*(t-e.timelineStart)/e.timelineUnitDuration,o=e.eventSlotHeight*i/e.timelineUnitDuration;$(this).css({top:a-1+"px",height:o+1+"px"})}),this.element.removeClass("loading")},e.prototype.openModal=function(e){var t=this,n=t.mq();if(this.animating=!0,this.modalHeader.find(".event-name").text(e.find(".event-name").text()),this.modalHeader.find(".event-date").text(e.find(".event-date").text()),this.modal.attr("data-event",e.parent().attr("data-event")),this.modalBody.find(".event-info").load(e.parent().attr("data-content")+".html .event-info > *",function(e){t.element.addClass("content-loaded")}),this.element.addClass("modal-is-open"),setTimeout(function(){e.parent("li").addClass("selected-event")},10),"mobile"==n)t.modal.one(a,function(){t.modal.off(a),t.animating=!1});else{var s=e.offset().top-$(window).scrollTop(),d=e.offset().left,l=e.innerHeight(),m=e.innerWidth(),r=$(window).width(),h=$(window).height(),c=.8*r>t.modalMaxWidth?t.modalMaxWidth:.8*r,p=.8*h>t.modalMaxHeight?t.modalMaxHeight:.8*h,f=parseInt((r-c)/2-d),g=parseInt((h-p)/2-s),v=p/l,u=c-m;t.modal.css({top:s+"px",left:d+"px",height:p+"px",width:c+"px"}),i(t.modal,"translateY("+g+"px) translateX("+f+"px)"),t.modalHeader.css({width:m+"px"}),t.modalBody.css({marginLeft:m+"px"}),t.modalBodyBg.css({height:l+"px",width:"1px"}),i(t.modalBodyBg,"scaleY("+v+") scaleX("+u+")"),t.modalHeaderBg.css({height:l+"px",width:m+"px"}),i(t.modalHeaderBg,"scaleY("+v+")"),t.modalHeaderBg.one(a,function(){t.modalHeaderBg.off(a),t.animating=!1,t.element.addClass("animation-completed")})}o||t.modal.add(t.modalHeaderBg).trigger(a)},e.prototype.closeModal=function(e){var t=this,n=t.mq();if(this.animating=!0,"mobile"==n)this.element.removeClass("modal-is-open"),this.modal.one(a,function(){t.modal.off(a),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")});else{var s=e.offset().top-$(window).scrollTop(),d=e.offset().left,l=e.innerHeight(),m=e.innerWidth(),r=Number(t.modal.css("top").replace("px","")),h=Number(t.modal.css("left").replace("px","")),c=d-h,p=s-r;t.element.removeClass("animation-completed modal-is-open"),this.modal.css({width:m+"px",height:l+"px"}),i(t.modal,"translateX("+c+"px) translateY("+p+"px)"),i(t.modalBodyBg,"scaleX(0) scaleY(1)"),i(t.modalHeaderBg,"scaleY(1)"),this.modalHeaderBg.one(a,function(){t.modalHeaderBg.off(a),t.modal.addClass("no-transition"),setTimeout(function(){t.modal.add(t.modalHeader).add(t.modalBody).add(t.modalHeaderBg).add(t.modalBodyBg).attr("style","")},10),setTimeout(function(){t.modal.removeClass("no-transition")},20),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")})}o||t.modal.add(t.modalHeaderBg).trigger(a)},e.prototype.mq=function(){var e=this;return window.getComputedStyle(this.element.get(0),"::before").getPropertyValue("content").replace(/["']/g,"")},e.prototype.checkEventModal=function(e){this.animating=!0;var t=this,n=this.mq();if("mobile"==n)t.modal.add(t.modalHeader).add(t.modalHeaderBg).add(t.modalBody).add(t.modalBodyBg).attr("style",""),t.modal.removeClass("no-transition"),t.animating=!1;else if("desktop"==n&&t.element.hasClass("modal-is-open")){t.modal.addClass("no-transition"),t.element.addClass("animation-completed");var a=t.eventsGroup.find(".selected-event"),o=a.offset().top-$(window).scrollTop(),s=a.offset().left,d=a.innerHeight(),l=a.innerWidth(),m=$(window).width(),r=$(window).height(),h=.8*m>t.modalMaxWidth?t.modalMaxWidth:.8*m,c=.8*r>t.modalMaxHeight?t.modalMaxHeight:.8*r,p=c/d,f=h-l;setTimeout(function(){t.modal.css({width:h+"px",height:c+"px",top:r/2-c/2+"px",left:m/2-h/2+"px"}),i(t.modal,"translateY(0) translateX(0)"),t.modalBodyBg.css({height:c+"px",width:"1px"}),i(t.modalBodyBg,"scaleX("+f+")"),t.modalHeader.css({width:l+"px"}),t.modalBody.css({marginLeft:l+"px"}),t.modalHeaderBg.css({height:d+"px",width:l+"px"}),i(t.modalHeaderBg,"scaleY("+p+")")},10),setTimeout(function(){t.modal.removeClass("no-transition"),t.animating=!1},20)}};var s=$(".cd-schedule"),d=[],l=!1;s.length>0&&s.each(function(){d.push(new e($(this)))}),$(window).on("resize",function(){l||(l=!0,window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t))}),$(window).keyup(function(e){27==e.keyCode&&d.forEach(function(e){e.closeModal(e.eventsGroup.find(".selected-event"))})})});